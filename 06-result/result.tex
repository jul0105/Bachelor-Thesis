\documentclass[../report.tex]{subfiles}

\usepgfplotslibrary{statistics}

\begin{document}

\chapter{Results} % Performance comparison for the KHAPE library (not the password manager use case).
 


\section{KHAPE endpoints} % What endpoint take the most time during auth and register ? 
% 2 boite à moustache (en mode histogram), x = each endpoint, y = time
% \pgfplotsset{width=\textwidth, height=6cm}

\pgfplotsset{width=\textwidth-1.1cm}


\subsection*{Registration}

\begin{tikzpicture}
\begin{axis}[
    xbar,
    y=0.8cm,
    xmin=0, xmax=385,
    enlarge y limits=0.25,
    enlarge x limits={0.15, upper},
    legend style={at={(0.5,-0.2)},
    anchor=north,legend columns=-1},
    xlabel={microseconde},
    symbolic y coords={server finish, client finish, server start, client start},
    ytick=data,
    nodes near coords,
    nodes near coords align={horizontal},
]
\addplot coordinates {
    (0.15336,server finish)
    (201.33,client finish)
    (191.62,server start)
    (66.105,client start)
};
\end{axis}
\end{tikzpicture}


\subsection*{Authentication}

\begin{tikzpicture}
\begin{axis}[
    xbar,
    y=0.8cm,
    xmin=0, xmax=385,
    enlarge y limits=0.25,
    enlarge x limits={0.15, upper},
    legend style={at={(0.5,-0.2)},
    anchor=north,legend columns=-1},
    xlabel={microseconde},
    symbolic y coords={client finish, server finish, client ke, server start, client start},
    ytick=data,
    nodes near coords,
    nodes near coords align={horizontal},
]
\addplot coordinates {
    (0.086069,client finish)
    (185.38,server finish)
    (387.39,client ke)
    (189.93,server start)
    (67.308,client start)
};
\end{axis}
\end{tikzpicture}



\subsection{Ideal Cipher vs AES} % isolated, endpoints, overall. How does it change the performance of each endpoint and overall ?
% 2 boite à moustache (en mode histogram), x = each endpoint, y = time. Comparison with the standard time (above)

\subsection{With OPRF vs without OPRF} % endpoints, overall. How does it change the performance of each endpoint and overall ?
% 2 boite à moustache (en mode histogram), x = each endpoint, y = time. Comparison with the standard time (above)

\subsection*{Registration}

\begin{tikzpicture}
\begin{axis}[
    xbar=0pt,
    y=1.1cm,
    xmin=0, xmax=385,
    enlarge y limits=0.25,
    enlarge x limits={0.15, upper},
    legend pos=north east,
    legend cell align=left,
    xlabel={microseconde},
    symbolic y coords={server finish, client finish, server start, client start},
    ytick=data,
    nodes near coords,
    nodes near coords align={horizontal},
]
\addplot coordinates {
    (0.15336,server finish)
    (201.33,client finish)
    (191.62,server start)
    (66.105,client start)
};
\addplot coordinates {
    (0.15736,server finish)
    (132.45,client finish)
    (119.70,server start)
    (0.039084,client start)
};
\legend{With OPRF,Without OPRF}
\end{axis}
\end{tikzpicture}



\subsection*{Authentication}

\begin{tikzpicture}
\begin{axis}[
    xbar=0pt,
    y=1.1cm,
    xmin=0, xmax=385,
    enlarge y limits=0.25,
    enlarge x limits={0.15, upper},
    legend pos=north east,
    legend cell align=left,
    xlabel={microseconde},
    symbolic y coords={client finish, server finish, client ke, server start, client start},
    ytick=data,
    nodes near coords,
    nodes near coords align={horizontal},
]
\addplot coordinates {
    (0.086069,client finish)
    (185.38,server finish)
    (387.39,client ke)
    (189.93,server start)
    (67.308,client start)
};
\addplot coordinates {
    (0.085906,client finish)
    (185.49,server finish)
    (318.02,client ke)
    (121.29,server start)
    (0.039352,client start)
};
\legend{With OPRF,Without OPRF}
\end{axis}
\end{tikzpicture}

\subsection{With SlowHash vs without SlowHash} % endpoints, overall. How does it change the performance of each endpoint and overall ?
% 2 boite à moustache (en mode histogram), x = each endpoint, y = time. Comparison with the standard time (above)


\subsection*{Registration}

\begin{tikzpicture}
\begin{axis}[
    xbar=0pt,
    y=1.1cm,
    xmin=0, xmax=8300,
    enlarge y limits=0.25,
    enlarge x limits={0.15, upper},
    legend pos=north east,
    legend cell align=left,
    xlabel={microseconde},
    symbolic y coords={server finish, client finish, server start, client start},
    ytick=data,
    nodes near coords,
    nodes near coords align={horizontal},
]
\addplot coordinates {
    (0.16100,server finish)
    (8173.6,client finish)
    (196.37,server start)
    (66.713,client start)
};
\addplot coordinates {
    (0.15336,server finish)
    (201.33,client finish)
    (191.62,server start)
    (66.105,client start)
};
\legend{With SlowHash,Without SlowHash}
\end{axis}
\end{tikzpicture}



\subsection*{Authentication}

\begin{tikzpicture}
\begin{axis}[
    xbar=0pt,
    y=1.1cm,
    xmin=0, xmax=8300,
    enlarge y limits=0.25,
    enlarge x limits={0.15, upper},
    legend pos=north east,
    legend cell align=left,
    xlabel={microseconde},
    symbolic y coords={client finish, server finish, client ke, server start, client start},
    ytick=data,
    nodes near coords,
    nodes near coords align={horizontal},
]
\addplot coordinates {
    (0.086840,client finish)
    (186.55,server finish)
    (8287.6,client ke)
    (196.05,server start)
    (68.013,client start)
};
\addplot coordinates {
    (0.086069,client finish)
    (185.38,server finish)
    (387.39,client ke)
    (189.93,server start)
    (67.308,client start)
};
\legend{With SlowHash,Without SlowHash}
\end{axis}
\end{tikzpicture}


\section{Components benchmark}
\subsection{Encryption (vs AES)}

\subsection*{Ideal cipher}

\pgfplotsset{height=6cm}
\begin{tikzpicture}
\begin{axis}[
    boxplot,
    boxplot/draw direction=x,
    xmin=7.4, xmax=8.55,
    xlabel={microseconde},
    ytick={1,2},
    yticklabels={decrypt,encrypt},
]
\addplot table[y=value]{data/component/ideal_cipher_decryption.dat};
\addplot table[y=value]{data/component/ideal_cipher_encryption.dat};
\end{axis}
\end{tikzpicture}

\subsection*{AES256-CTR}

\begin{tikzpicture}
\begin{axis}[
    boxplot,
    boxplot/draw direction=x,
    xmin=0.211, xmax=0.232,
    xlabel={microseconde},
    ytick={1,2},
    yticklabels={decrypt,encrypt},
]
\addplot table[y=value]{data/component/aes_decryption.dat};
\addplot table[y=value]{data/component/aes_encryption.dat};
\end{axis}
\end{tikzpicture}

\subsection{TripleDH}

\begin{tikzpicture}
\begin{axis}[
    boxplot,
    boxplot/draw direction=x,
%     xmin=0.211, xmax=0.232,
    xlabel={microseconde},
    ytick={1,2},
    yticklabels={server,client},
]
\addplot table[y=value]{data/component/tripledh_compute_server.dat};
\addplot table[y=value]{data/component/tripledh_compute_client.dat};
\end{axis}
\end{tikzpicture}

\subsection{Key generation}
\pgfplotsset{height=4cm}
\begin{tikzpicture}
\begin{axis}[
    boxplot,
    boxplot/draw direction=x,
%     xmin=0.211, xmax=0.232,
    xlabel={microseconde},
    ytick={1},
    yticklabels={generate},
]
\addplot table[y=value]{data/component/group_generate_keys.dat};
\end{axis}
\end{tikzpicture}

\begin{tikzpicture}
\begin{axis}[
    boxplot,
    boxplot/draw direction=x,
%     xmin=0.211, xmax=0.232,
    xlabel={microseconde},
    ytick={1},
    yticklabels={compute},
]
\addplot table[y=value]{data/component/group_compute_shared_key.dat};
\end{axis}
\end{tikzpicture}





\section{OPAQUE endpoints} % same as KHAPE endpoints. Shows default parameters and similar parameters as KHAPE

Note that OPAQUE has only 4 functions for the authentication (where KHAPE needs 5) and for the registration, the server compute a server setup where he generate his key pair (in KHAPE, this is done in server start).
Benchmark is computed with a ciphersuite that is close to the primitive used for KHAPE : RistrettoPoint for OPRF, MontgomeryPoint for KE, TripleDH, Sha3 for hashing.
Note that the default ciphersuite for OPAQUE use Sha2 instead of Sha3 and RistrettoPoint for both OPRF and KE. Performance are relatively similar between the two ciphersuites.

\pgfplotsset{width=\textwidth-1.1cm}


\subsection*{Registration}

\begin{tikzpicture}
\begin{axis}[
    xbar,
    y=0.8cm,
    xmin=0, xmax=385,
    enlarge y limits=0.25,
    enlarge x limits={0.15, upper},
    legend style={at={(0.5,-0.2)},
    anchor=north,legend columns=-1},
    xlabel={microseconde},
    symbolic y coords={server finish, client finish, server start, client start, server setup},
    ytick=data,
    nodes near coords,
    nodes near coords align={horizontal},
]
\addplot coordinates {
    (0.13187,server finish)
    (133.80,client finish)
    (66.797,server start)
    (62.885,client start)
    (114.80,server setup)
};
\end{axis}
\end{tikzpicture}


\subsection*{Authentication}

\begin{tikzpicture}
\begin{axis}[
    xbar,
    y=0.8cm,
    xmin=0, xmax=385,
    enlarge y limits=0.25,
    enlarge x limits={0.15, upper},
    legend style={at={(0.5,-0.2)},
    anchor=north,legend columns=-1},
    xlabel={microseconde},
    symbolic y coords={server finish, client finish, server start, client start},
    ytick=data,
    nodes near coords,
    nodes near coords align={horizontal},
]
\addplot coordinates {
    (2.2455,server finish)
    (324.08,client finish)
    (369.59,server start)
    (125.40,client start)
};
\end{axis}
\end{tikzpicture}


\section{OPAQUE vs KHAPE} % endpoints, overall. How does KHAPE performance compare to OPAQUE with ~same~ parameters (OPRF, no SlowHash, same curve ?, same hash ?)
% 2 histogram, one for auth overall, one for register overall, x = OPAQUE(default) OPAQUE(same params) KHAPE(IC OPRF) KHAPE(IC noOPRF) KHAPE(AES OPRF) KHAPE(AES noOPRF), y = time. Each histogram bar is separated in another color to show each endpoint proportion
% highlight the 2 bar where OPAQUE and KHAPE have the same params, put the rest aside (just for info)

\pgfplotsset{width=\textwidth-2.4cm}


\subsection*{Registration}

\begin{tikzpicture}
\begin{axis}[
    xbar stacked,
    y=0.8cm,
%     xmin=0, xmax=600,
    enlarge y limits=0.45,
    enlarge x limits={0.15, upper},
    legend style={
        at={(0.5,-0.5)},
        anchor=north
    },
    legend columns=3,
    xlabel={microseconde},
    symbolic y coords={KHAPE w/o OPRF, KHAPE w/ OPRF, OPAQUE},
    ytick=data,
%     nodes near coords,
%     nodes near coords align={vertical},
]
\addplot coordinates { % server setup
    (114.80,OPAQUE) (0,KHAPE w/ OPRF) (0,KHAPE w/o OPRF)
};
\addplot coordinates { % client start
    (62.885,OPAQUE) (66.105,KHAPE w/ OPRF) (0.039084,KHAPE w/o OPRF)
};
\addplot coordinates { % server start
    (66.797,OPAQUE) (191.62,KHAPE w/ OPRF) (119.70,KHAPE w/o OPRF)
};
\addplot coordinates { % client finish
    (133.80,OPAQUE) (201.33,KHAPE w/ OPRF) (132.45,KHAPE w/o OPRF)
};
\addplot coordinates { % server finish
    (0.13187,OPAQUE) (0.15336,KHAPE w/ OPRF) (0.15736,KHAPE w/o OPRF)
};
\legend{Server setup, Client start, Server start, Client finish, Server finish}
\end{axis}
\end{tikzpicture}

\subsection*{Authentication}

\begin{tikzpicture}
\begin{axis}[
    xbar stacked,
    y=0.8cm,
%     xmin=0, xmax=600,
    enlarge y limits=0.45,
    enlarge x limits={0.15, upper},
    legend style={
        at={(0.5,-0.5)},
        anchor=north
    },
    legend columns=3,
    xlabel={microseconde},
    symbolic y coords={KHAPE w/o OPRF, KHAPE w/ OPRF, OPAQUE},
    ytick=data,
%     nodes near coords,
%     nodes near coords align={vertical},
]
\addplot coordinates { % client start
    (125.40,OPAQUE) (67.308,KHAPE w/ OPRF) (0.039352,KHAPE w/o OPRF)
};
\addplot coordinates { % server start
    (369.59,OPAQUE) (189.93,KHAPE w/ OPRF) (121.29,KHAPE w/o OPRF)
};
\addplot coordinates { % client ke
    (0,OPAQUE) (387.39,KHAPE w/ OPRF) (318.02,KHAPE w/o OPRF)
};
\addplot coordinates { % server finish
    (2.2455,OPAQUE) (185.38,KHAPE w/ OPRF) (185.49,KHAPE w/o OPRF)
};
\addplot coordinates { % client finish
    (324.08,OPAQUE) (0.086069,KHAPE w/ OPRF) (0.085906,KHAPE w/o OPRF)
};
\legend{Client start, Server start, Client KE, Server finish, Client finish}
\end{axis}
\end{tikzpicture}


% KHAPE without OPRF
% \addplot coordinates {
%     (0.085906,client finish)
%     (185.49,server finish)
%     (318.02,client ke)
%     (121.29,server start)
%     (0.039352,client start)
% };


\section{Input size} % Does the uid and password size has any inpact on the performance of auth and register ?

\section{Message size}

% \newpage
% 
% 
% \subsection{Registration}
% 
% \pgfplotsset{width=10cm, height=8cm}
% 
% \begin{tikzpicture}
% \begin{axis}[
%     ybar,
%     enlarge x limits=0.15,
%     enlarge y limits={0.15, upper},
%     legend style={at={(0.5,-0.2)},
%     anchor=north,legend columns=-1},
%     ylabel={microseconde},
%     symbolic x coords={client start, server start, client finish, server finish},
%     xtick=data,
%     nodes near coords,
%     nodes near coords align={vertical},
%     x tick label style={rotate=45,anchor=east},
% ]
% \addplot coordinates {
%     (client start,66.105) (server start,191.62) (client finish,201.33)
%     (server finish,0.15336)
% };
% \end{axis}
% \end{tikzpicture}
% 
% 
% \pgfplotsset{width=\textwidth, height=6cm}
% 
% \begin{tikzpicture}
% \begin{axis}[
%     xbar,
%     enlarge y limits=0.2,
%     enlarge x limits={0.15, upper},
%     legend style={at={(0.5,-0.2)},
%     anchor=north,legend columns=-1},
%     xlabel={microseconde},
%     symbolic y coords={server finish, client finish, server start, client start},
%     ytick=data,
%     nodes near coords,
%     nodes near coords align={horizontal},
% ]
% \addplot coordinates {
%     (0.15336,server finish)
%     (201.33,client finish)
%     (191.62,server start)
%     (66.105,client start)
% };
% \end{axis}
% \end{tikzpicture}
% 
% \newpage
% 
% 
% \pgfplotsset{width=\textwidth, height=8cm}
% \usepgfplotslibrary{statistics}
% 
% \subsection{Registration}
% 
% \begin{tikzpicture}
% \begin{axis}[
%     boxplot,
%     boxplot/draw direction=y,
%     xtick={1,2,3,4},
%     xticklabels={client start, server start, client finish, server finish},
%     ylabel={microseconde},
% ]
% \addplot table[y=value]{data/khape_standard/client_register_start.dat};
% \addplot table[y=value]{data/khape_standard/server_register_start.dat};
% \addplot table[y=value]{data/khape_standard/client_register_finish.dat};
% \addplot table[y=value]{data/khape_standard/server_register_finish.dat};
% \end{axis}
% \end{tikzpicture}
% 
% \subsection{Authentication}
% 
% \begin{tikzpicture}
% \begin{axis}[
%     boxplot,
%     boxplot/draw direction=y,
%     xtick={1,2,3,4,5},
%     xticklabels={client start, server start, client ke, server finish, client finish},
%     ylabel={microseconde},
% ]
% \addplot table[y=value]{data/khape_standard/client_auth_start.dat};
% \addplot table[y=value]{data/khape_standard/server_auth_start.dat};
% \addplot table[y=value]{data/khape_standard/client_auth_ke.dat};
% \addplot table[y=value]{data/khape_standard/server_auth_finish.dat};
% \addplot table[y=value]{data/khape_standard/client_auth_finish.dat};
% \end{axis}
% \end{tikzpicture}
% 
% 
% 
% 
% \subsection{Registration}
% 
% \begin{tikzpicture}
% \begin{axis}[
%     boxplot,
%     boxplot/draw direction=x,
%     ytick={1,2,3,4},
%     yticklabels={client start, server start, client finish, server finish},
%     xlabel={microseconde},
% ]
% \addplot table[y=value]{data/khape_standard/client_register_start.dat};
% \addplot table[y=value]{data/khape_standard/server_register_start.dat};
% \addplot table[y=value]{data/khape_standard/client_register_finish.dat};
% \addplot table[y=value]{data/khape_standard/server_register_finish.dat};
% \end{axis}
% \end{tikzpicture}
% 
% \subsection{Authentication}
% 
% \begin{tikzpicture}
% \begin{axis}[
%     boxplot,
%     boxplot/draw direction=x,
%     ytick={1,2,3,4,5},
%     yticklabels={client start, server start, client ke, server finish, client finish},
%     xlabel={microseconde},
% ]
% \addplot table[y=value]{data/khape_standard/client_auth_finish.dat};
% \addplot table[y=value]{data/khape_standard/server_auth_finish.dat};
% \addplot table[y=value]{data/khape_standard/client_auth_ke.dat};
% \addplot table[y=value]{data/khape_standard/server_auth_start.dat};
% \addplot table[y=value]{data/khape_standard/client_auth_start.dat};
% \end{axis}
% \end{tikzpicture}
% 
% 
% \newpage
% 
% 
% \pgfplotsset{width=4cm, height=8cm}
% \begin{tikzpicture}
% \begin{axis}[
%     boxplot,
%     boxplot/draw direction=y,
%     ylabel={us},
% ]
% \addplot table[y=value]{data/khape_standard/client_auth_start.dat};
% \end{axis}
% \end{tikzpicture}
% 
% 
% \begin{tikzpicture}
% \begin{axis}[
%     boxplot,
%     boxplot/draw direction=y,
%     ylabel={us},
% ]
% \addplot table[y=value]{data/khape_standard/server_auth_start.dat};
% \end{axis}
% \end{tikzpicture}
% 
% 
% \pgfplotsset{width=10cm, height=4cm}
% \begin{tikzpicture}
% \begin{axis}[
%     boxplot,
%     boxplot/draw direction=x,
%     xlabel={us},
% ]
% \addplot table[y=value]{data/khape_standard/client_auth_start.dat};
% \end{axis}
% \end{tikzpicture}
% 
% 
% \begin{tikzpicture}
% \begin{axis}[
%     boxplot,
%     boxplot/draw direction=x,
%     xlabel={us},
% ]
% \addplot table[y=value]{data/khape_standard/server_auth_start.dat};
% \end{axis}
% \end{tikzpicture}

\end{document}

